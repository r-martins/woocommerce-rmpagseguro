!function(g){"use strict";g(function(){var u=!1;function r(e){g("#pagseguro-credit-card-form").attr("data-credit-card-brand",e)}function n(e){return'<option value="'+e.quantity+'" data-installment-value="'+e.installmentAmount+'">'+(a=e,r="R$ "+parseFloat(a.installmentAmount,10).toFixed(2).replace(".",",").toString(),t="R$ "+parseFloat(a.totalAmount,10).toFixed(2).replace(".",",").toString(),o=!0===a.interestFree?" "+wc_pagseguro_params.interest_free:"",n=o||" ("+t+")",a.quantity+"x "+r+n)+"</option>";var a,r,t,o,n}function p(e){var a=g("#pagseguro-credit-card-form");g(".woocommerce-error",a).remove(),a.prepend('<div class="woocommerce-error" style="margin-bottom: 0.5em !important;">'+e+"</div>")}function t(e){g(".pagseguro-method-form").hide(),g("#pagseguro-payment-methods li").removeClass("active"),g("#pagseguro-"+e+"-form").show(),g("#pagseguro-payment-method-"+e).parent("label").parent("li").addClass("active")}function e(){var e;e=g("#pagseguro-payment-methods"),1===g("input[type=radio]",e).length&&e.hide(),g("#pagseguro-payment-form").show(),t(g("#pagseguro-payment-methods input[type=radio]:checked").val()),g("#pagseguro-card-holder-cpf").mask("000.000.000-00"),g("#pagseguro-card-holder-birth-date").mask("00/00/0000");var o=function(e){return 11===e.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009"},a={onKeyPress:function(e,a,r,t){r.mask(o.apply({},arguments),t)}};g("#pagseguro-card-holder-phone").mask(o,a),g("#pagseguro-bank-transfer-form input[type=radio]:checked").parent("label").parent("li").addClass("active")}function a(){if(u)return!(u=!1);if(!g("#payment_method_pagseguro").is(":checked"))return!0;if("credit-card"!==g("body li.payment_method_pagseguro input[name=pagseguro_payment_method]:checked").val())return g("form.checkout, form#order_review").append(g('<input name="pagseguro_sender_hash" type="hidden" />').val(PagSeguroDirectPayment.getSenderHash())),!0;var a=g("form.checkout, form#order_review"),e=!1,r="",t=g("#pagseguro-credit-card-form",a).attr("data-credit-card-brand"),o=g("#pagseguro-card-number",a).val().replace(/[^\d]/g,""),n=g("#pagseguro-card-cvc",a).val(),s=g("#pagseguro-card-expiry",a).val().replace(/[^\d]/g,"").substr(0,2),i=g("#pagseguro-card-expiry",a).val().replace(/[^\d]/g,"").substr(2),c=g("#pagseguro-card-installments",a),d=new Date;return r+="<ul>",void 0!==t&&"error"!==t||(r+="<li>"+wc_pagseguro_params.invalid_card+"</li>",e=!0),2===s.length&&2===i.length||(r+="<li>"+wc_pagseguro_params.invalid_expiry+"</li>",e=!0),2===s.length&&2===i.length&&(12<s||i<d.getFullYear().toString().slice(-2)||i>=1*d.getFullYear().toString().slice(-2)+20||s<d.getMonth()+2&&i.toString()===d.getFullYear().toString().slice(-2))&&(r+="<li>"+wc_pagseguro_params.expired_date+"</li>",e=!0),"0"===c.val()&&(r+="<li>"+wc_pagseguro_params.empty_installments+"</li>",e=!0),r+="</ul>",e?p(r):PagSeguroDirectPayment.createCardToken({brand:t,cardNumber:o,cvv:n,expirationMonth:s,expirationYear:"20"+i,success:function(e){g("input[name=pagseguro_credit_card_hash], input[name=pagseguro_credit_card_hash], input[name=pagseguro_installment_value]",a).remove(),a.append(g('<input name="pagseguro_credit_card_hash" type="hidden" />').val(e.card.token)),a.append(g('<input name="pagseguro_sender_hash" type="hidden" />').val(PagSeguroDirectPayment.getSenderHash())),a.append(g('<input name="pagseguro_installment_value" type="hidden" />').val(g("option:selected",c).attr("data-installment-value"))),u=!0,a.submit()},error:function(){p(wc_pagseguro_params.general_error)}}),!1}wc_pagseguro_params.session_id?(PagSeguroDirectPayment.setSessionId(wc_pagseguro_params.session_id),"1"===wc_checkout_params.is_checkout?g("body").on("updated_checkout",function(){e()}):e(),g("body").on("click","#pagseguro-bank-transfer-form input[type=radio]",function(){g("#pagseguro-bank-transfer-form li").removeClass("active"),g(this).parent("label").parent("li").addClass("active")}),g("body").on("click","#pagseguro-payment-methods input[type=radio]",function(){t(g(this).val())}),g("body").on("focusout","#pagseguro-card-number",function(){var e=g(this).val().replace(/[^\d]/g,"").substr(0,6),a=g("body #pagseguro-card-installments");6===e.length&&(a.empty(),a.attr("disabled","disabled"),PagSeguroDirectPayment.getBrand({cardBin:e,success:function(e){g("body").trigger("pagseguro_credit_card_brand",e.brand.name),r(e.brand.name)},error:function(){g("body").trigger("pagseguro_credit_card_brand","error"),r("error")}}))}),g("body").on("updated_checkout",function(){var e=g("body #pagseguro-card-number");0<e.length&&e.focusout()}),g("body").on("focus","#pagseguro-card-number, #pagseguro-card-expiry",function(){g("#pagseguro-credit-card-form .woocommerce-error").remove()}),g("body").on("pagseguro_credit_card_brand",function(e,a){if("error"!==a){var r=parseFloat(g("body #pagseguro-payment-form").data("cart_total")),t=null;switch(wc_pagseguro_params.cc_installment_options){case"fixed":t=wc_pagseguro_params.cc_installment_options_fixed;break;case"min_total":t=r/wc_pagseguro_params.cc_installments_options_min_total,t=Math.floor(t);break;default:t=0}var o={amount:r,brand:a,success:function(e){var r=g("body #pagseguro-card-installments");!1===e.error?(r.empty(),r.removeAttr("disabled"),r.append('<option value="0">--</option>'),g.each(e.installments[a],function(e,a){r.append(n(a))})):p(wc_pagseguro_params.invalid_card)},error:function(){p(wc_pagseguro_params.invalid_card)}};null!=t&&(o.maxInstallmentNoInterest=1,0==t?delete o.maxInstallmentNoInterest:t<=r&&(o.maxInstallmentNoInterest=t)),PagSeguroDirectPayment.getInstallments(o)}else p(wc_pagseguro_params.invalid_card)}),g("form.checkout").on("checkout_place_order_pagseguro",function(){return a()}),g("form#order_review").submit(function(){return a()})):g("body").on("updated_checkout",function(){g("#pagseguro-payment-form").remove()})})}(jQuery);